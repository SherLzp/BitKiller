 var traceDebugFlag=true;var trace=function(params){if(traceDebugFlag&&params){var str="";for(var i=0;i<arguments.length;i++){if(i==arguments.length-1){str+=arguments[i];}else{str+=arguments[i]+" ";}};var datestr="";var date=new Date();datestr+="["+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()+"] ";str=datestr+str;try{console.log(str);}catch(e){};try{document.getElementById('logContainer').innerHTML+=str+"<br/>";}catch(e){}}}  ;function supportTouch(){return document.hasOwnProperty('ontouchstart');} ;function supportMPEGVideo(){return!!document.createElement("video").canPlayType("video/mp4");} ;function supportCanvas(){return!!document.createElement("canvas").getContext;} ;function supportLocalStorage(){return(('localStorage'in window)&&window['localStorage']!=null)?true:false;} ;function supportWebWorkers(){return window.Worker?true:false;} ;function supportFlash(){var hasFlash=0;var flashVersion=0;if(window.document.all){var swf=new ActiveXObject('ShockwaveFlash.ShockwaveFlash');if(swf){hasFlash=1;var VSwf=swf.GetVariable("$version");flashVersion=parseInt(VSwf.split(" ")[1].split(",")[0]);}}else{if(window.navigator.plugins&&window.navigator.plugins.length>0){var swf=navigator.plugins["Shockwave Flash"];if(swf){hasFlash=1;var words=swf.description.split(" ");for(var i=0;i<words.length;++i){if(isNaN(parseInt(words[i])))continue;flashVersion=parseInt(words[i]);}}}};return{f:hasFlash,v:flashVersion};} ;var uplayer={core:{UPLAYER:null,UPLAYER_HTML5:null},utils:{IDUtil:null,TimeUtil:null,StorageUtil:null,VisibleUtil:null,FullScreenUtil:null},vars:{'skinnable':1,coop:'uplayer'},sys:{os:'',br:''},callbackConnection:null,JSDK:null,JSEvent:null}; var UPLAYER_LOCAL_CONF={VERSION:"uplayer_v1_20141227",FLASH_PLAYER_URL:"bin/Player.swf",FLASH_INSTALL_URL:"bin/playerProductInstall.swf",SYSTEM:{PC:false,MOBILE:false}}; var UPLAYER_GLOBAL_CONF={APP_WIDTH:320,APP_HEIGHT:240,APP_NORMAL_WIDTH:320,APP_NORMAL_HEIGHT:240,VIDEO:null,VIDEO_PLAYING:false}; var UPLAYER_AD_CONF={TYPE:{HEAD:"head",PAUSE:"pause",MIDDLE:"middle",TAIL:"tail"},MATE:{BITMAP:"bitmap",VIDEO:"video"},EVENT:{END:"end",START:"start"}}; var UPLAYER_STORAGE={VOLUME:"volume",RECORDS:"records"}; var UPLAYER_CONTAINER_NAME={ROOT:"uplayer_container_root",VIDEO:"uplayer_video"} ;var UPLAYER_ERROR={VERSION_ERROR:'990',INIT_ERROR:'1000',PLAY_ERROR:'1100',OTHER_ERROR:'1900'}; var UPLAYER_STAT={LOG_URL:'',LOG_PLAY_TYPE:{VV:'vv',CV:'cv',TIME:'time'},OP:{LOG_PLAY:'logPlay',LOG_ENV:'logEnv',OP_REFRESH_VV:'opRefreshVV',OP_RESUME_HEAD:'opResumeHead',OP_PAUSE_HEAD:'opPauseHead'}};var uplayer_system_agent=window.navigator.userAgent.toLocaleLowerCase();try{if(uplayer_system_agent.indexOf('android')!=-1){UPLAYER_LOCAL_CONF.SYSTEM.MOBILE=true;uplayer.sys.os='android';}else if(uplayer_system_agent.indexOf('ios')!=-1){UPLAYER_LOCAL_CONF.SYSTEM.MOBILE=true;uplayer.sys.os='ios';}else if(uplayer_system_agent.indexOf('windows')!=-1){UPLAYER_LOCAL_CONF.SYSTEM.PC=true;uplayer.sys.os='windows';}else if(uplayer_system_agent.indexOf('mac')!=-1){UPLAYER_LOCAL_CONF.SYSTEM.PC=true;uplayer.sys.os='mac';}else{uplayer.sys.os='other';}}catch(e){};try{if(uplayer_system_agent.indexOf("msie")>=0){var value=uplayer_system_agent.split(";")[1];uplayer.sys.br="ie"+parseInt(value.split(" ")[1]);}else if(uplayer_system_agent.indexOf("360se")>=0){uplayer.sys.br="360";}else if(uplayer_system_agent.indexOf("tencent")>=0){uplayer.sys.br="qq";}else if(uplayer_system_agent.indexOf("se 2.x")>=0){uplayer.sys.br="sogou";}else if(uplayer_system_agent.indexOf("tencent")>=0){uplayer.sys.br="qq";}else if(uplayer_system_agent.indexOf("firefox")>=0){uplayer.sys.br="ff";}else if(uplayer_system_agent.indexOf("chrome")>=0){uplayer.sys.br="chrome";}else if(uplayer_system_agent.indexOf("safari")>=0){uplayer.sys.br="safa";}else if(uplayer_system_agent.indexOf("opera")>=0){uplayer.sys.br="opera";}else{uplayer.sys.br="other";}}catch(e){} ;uplayer.JSEvent={PLAYER_INIT:"PLAYER_INIT",VIDEO_START:"VIDEO_START",VIDEO_EMPTY:"VIDEO_EMPTY",VIDEO_FULL:"VIDEO_FULL",VIDEO_STOP:"VIDEO_STOP",VIDEO_ERROR:"VIDEO_ERROR",RED5_INFO:"RED5_INFO"};uplayer.JSDK={PLAY_VIDEO:"playVideo",RESUME_VIDEO:"resumeVideo",PAUSE_VIDEO:"pauseVideo",SEEK_VIDEO:"seekVideo",CLOSE_VIDEO:"closeVideo",GET_VIDEO_TIME:"getVideoTime",GET_VIDEO_INFO:"getVideoInfo",GET_LOAD_PERCENT:"getLoadPercent",GET_BUFFER_PERCENT:"getBufferPercent",GET_VIDEO_VOLUME:"getVideoVolume",SET_VIDEO_VOLUME:"setVideoVolume",SET_VIDEO_PLAY_RATE:"setVideoPlayRate",SET_VIEW_PORT:"setViewPort"}; uplayer.utils.IDUtil={'createUUID':function(){var value="";var i=32;while(i--){value+=Math.floor(Math.random()*16).toString(16);};return value;}};  uplayer.utils.StorageUtil={'set':function(type,value){if(supportLocalStorage()){window.localStorage.setItem(type,value);}else{try{var arr=document.cookie.toString().split(";");var cookies={};for(var i=0;i<arr.length;i++){var item=arr[i].split("=");cookies[item[0]]=item[1];};cookies[type]=value;var cookieArr=[];for(var key in cookies){cookieArr.push(key+'='+cookies);};document.cookie=cookieArr.concat(';');}catch(e){}}},'get':function(type){if(type==null||type=="")return null;if(supportLocalStorage()){return window.localStorage.getItem(type);}else{try{var arr=document.cookie.toString().split(";");var cookies={};for(var i=0;i<arr.length;i++){var item=arr[i].split("=");cookies[item[0]]=item[1];};if(cookies.hasOwnProperty(type)){return cookies[type];}}catch(e){};return null;}},'cookieObject':function(){try{var arr=document.cookie.toString().split(";");var cookies={};for(var i=0;i<arr.length;i++){var item=arr[i].split("=");cookies[item[0]]=item[1];};return cookies;}catch(e){};return null;}}; uplayer.utils.TimeUtil={'parseTimeToStr':function(value){var hours="";var min="";if(parseInt(value/60)<10){hours="0"+parseInt(value/60)+":"}else{hours=parseInt(value/60)+":"};if(parseInt(value%60)<10){min="0"+parseInt(value%60)+"";}else{min=parseInt(value%60)+"";};return hours+min;},'parseTimeToArray':function(value){var hours="";var min="";if(parseInt(value/60)<10){hours="0"+parseInt(value/60);}else{hours=parseInt(value/60)+"";};if(parseInt(value%60)<10){min="0"+parseInt(value%60)+"";}else{min=parseInt(value%60)+"";};return[hours,min];},'parseNumToNormal':function(value){var str=value<=9?("0"+value):value;return str;},'parsePXToInt':function(value){return parseInt(value.split('px')[0]);}};  uplayer.utils.VisibleUtil={'isVisible':function(target){try{if(target.style.display!="none")return true;}catch(e){};return false;},'show':function(target){try{if(target.style.display=="none")target.style.display="block";return true;}catch(e){};return false;},'hide':function(target){try{if(target.style.display!="none")target.style.display="none";return true;}catch(e){};return false;}};  uplayer.utils.TimeUtil={'hash':function(string){function RotateLeft(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));};function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4){return(lResult^0x80000000^lX8^lY8);};if(lX4|lY4){if(lResult&0x40000000){return(lResult^0xC0000000^lX8^lY8);}else{return(lResult^0x40000000^lX8^lY8);}}else{return(lResult^lX8^lY8);}};function F(x,y,z){return(x&y)|((~x)&z);};function G(x,y,z){return(x&z)|(y&(~z));};function H(x,y,z){return(x^y^z);};function I(x,y,z){return(y^(x|(~z)));};function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1%64))/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;};lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);};return WordToHexValue;};function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}};return utftext;};var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD);};var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase();}} ;uplayer.utils.FullScreenUtil={'requestFullScreen':function(target){if(target.requestFullscreen){target.requestFullscreen();}else if(target.mozRequestFullScreen){target.mozRequestFullScreen();}else if(target.webkitRequestFullScreen){trace("--> webkit fullscreen");target.webkitRequestFullScreen();}else if(ALEX_GLOBAL_CONF.VIDEO.webkitEnterFullScreen){trace("--> webkit ios fullscreen");UPLAYER_GLOBAL_CONF.VIDEO.webkitEnterFullScreen();}},'exitFullScreen':function(target){if(!target)target=document;if(target.exitFullscreen){target.exitFullscreen();}else if(target.mozCancelFullScreen){target.mozCancelFullScreen();}else if(target.webkitCancelFullScreen){target.webkitCancelFullScreen();}else if(ALEX_GLOBAL_CONF.VIDEO.webkitExitFullScreen){UPLAYER_GLOBAL_CONF.VIDEO.webkitExitFullScreen();}}}; var UPLAYER_KERNEL=function(cal){var that=this;var callback=cal;var setting={'videoStart':false,'videoStop':false,'videoError':false,'playing':false,'duration':0,'url':null,'sumTime':0,'htime':0,'width':320,'height':240};var video=UPLAYER_GLOBAL_CONF.VIDEO;var videoTimeout=0;function setPlayTimeout(flag,seek){clearTimeout(videoTimeout);if(flag)videoTimeout=setTimeout(onPlayTimeout,seek?20000:10000);};function onPlayTimeout(){onVideoError();};function onVideoError(event){that.closeVideo();setting.videoError=true;callback(uplayer.JSEvent.VIDEO_ERROR);};function onVideoMeta(event){setting.width=video.videoWidth;setting.height=video.videoHeight;setting.duration=video.duration;if(setting.htime>0){try{video.currentTime=setting.htime;}catch(e){}}};function onVideoStart(event){if(!setting.videoStart){setPlayTimeout(false);resumeSumTimer();UPLAYER_GLOBAL_CONF.VIDEO_PLAYING=true;setting.videoStart=true;setting.videoStop=false;callback(uplayer.JSEvent.VIDEO_START,{'duration':setting.duration});}};function onVideoBufferFull(event){setPlayTimeout(false);resumeSumTimer();callback(uplayer.JSEvent.VIDEO_FULL);};function onVideoBufferEmpty(event){pauseSumTimer();callback(uplayer.JSEvent.VIDEO_EMPTY);};function onVideoStop(event){setPlayTimeout(false);setting.videoStart=false;setting.videoStop=true;UPLAYER_GLOBAL_CONF.VIDEO_PLAYING=false;callback(uplayer.JSEvent.VIDEO_STOP);};var _sumLastTime=0;var _sumTimer=0;function resumeSumTimer(){_sumLastTime=new Date().getTime();clearInterval(_sumTimer);_sumTimer=setInterval(onSumTimer,200);};function pauseSumTimer(){clearInterval(_sumTimer);};function onSumTimer(){var nowTime=new Date().getTime();setting.sumTime+=(nowTime-_sumLastTime);_sumLastTime=nowTime;}  ;this.playVideo=function(value){if(value&&value.data){this.closeVideo();video.addEventListener("error",onVideoError);video.addEventListener("loadedmetadata",onVideoMeta);video.addEventListener("canplay",onVideoStart);video.addEventListener("canplaythrough",onVideoBufferFull);video.addEventListener("waiting",onVideoBufferEmpty);video.addEventListener("ended",onVideoStop);trace("Kernel.load",value);setPlayTimeout(true);video.src=value.data;if(value.time&&value.time>0){setting.htime=value.time;};video.play();return true;}else{callback(uplayer.JSEvent.VIDEO_ERROR,1004);}};this.resumeVideo=function(){resumeSumTimer();if(video)video.play();UPLAYER_GLOBAL_CONF.VIDEO_PLAYING=true;return true;};this.pauseVideo=function(){pauseSumTimer();if(video)video.pause();UPLAYER_GLOBAL_CONF.VIDEO_PLAYING=false;return true;};this.seekVideo=function(value){if(video){pauseSumTimer();if(value<0){value=0;}else if(value>=setting.duration){value=setting.duration-3;};video.currentTime=value;video.play();};UPLAYER_GLOBAL_CONF.VIDEO_PLAYING=true;return true;};this.closeVideo=function(){setPlayTimeout(false);pauseSumTimer();setting.stime=0;setting.htime=0;setting.videoStart=false;setting.videoError=false;UPLAYER_GLOBAL_CONF.VIDEO_PLAYING=false;setting.videoError=false;if(video){video.removeEventListener("error",onVideoError);video.removeEventListener("loadedmetadata",onVideoMeta);video.removeEventListener("canplay",onVideoStart);video.removeEventListener("canplaythrough",onVideoBufferFull);video.removeEventListener("waiting",onVideoBufferEmpty);video.removeEventListener("ended",onVideoStop);try{video.currentTime=0;video.pause();}catch(e){}};return true;};this.getVideoTime=function(){if(video)return video.currentTime;return 0;};this.getVideoInfo=function(){return{'videoStart':setting.videoStart,'videoStop':setting.videoStop,'videoError':setting.videoError,'playing':UPLAYER_GLOBAL_CONF.VIDEO_PLAYING,'duration':setting.duration,'volume':this.getVideoVolume(),'width':setting.width,'height':setting.height,'sumTime':setting.sumTime,'time':this.getVideoTime()};} ;this.getLoadPercent=function(){try{var timeRanges=video.buffered;var len=timeRanges.length;var i=0,buffered=[];while(i<len){buffered.push({start:timeRanges.start(i),end:timeRanges.end(i)});i++;};var bufferedBarPercent=0;for(var i=0,len=buffered.length;i<len;i++){if(buffered[i].end-video.time>=0){bufferedBarPercent=buffered[i].end/this.duration*100+'%';break;}};return bufferedBarPercent;}catch(e){};return 0;};this.getBufferPercent=function(){return 0;};this.getVideoVolume=function(){if(video)return video.volume;return 0;} ;this.setVideoVolume=function(value){try{video.volume=value;return true;}catch(e){};return false;};this.setVideoPlayRate=function(value){try{video.playbackRate=value;return true;}catch(e){};return false;}} ;uplayer.core.UPLAYER_HTML5=function(callback,container,playervars){trace('[SUPPORT CANVAS]',supportCanvas());trace('[SUPPORT LOCALSTORAGE]',supportLocalStorage());trace('[SUPPORT WEBWORKER]',supportWebWorkers());trace('[SUPPORT VIDEO OGG/MP4/WEBM]',supportMPEGVideo());container.innerHTML="<video id='"+UPLAYER_CONTAINER_NAME.VIDEO+"' autoplay='true' style='width:100%;height:100%'></video>";UPLAYER_GLOBAL_CONF.VIDEO=document.getElementById(UPLAYER_CONTAINER_NAME.VIDEO);UPLAYER_GLOBAL_CONF.VIDEO.oncontextmenu=function(event){return false;};var kernel=new UPLAYER_KERNEL(onKernelStatus);var that=this;for(var key in uplayer.vars){if(playervars.hasOwnProperty(key)){uplayer.vars[key]=playervars[key];}};setInterval(function(){if(UPLAYER_GLOBAL_CONF.VIDEO&&UPLAYER_GLOBAL_CONF.VIDEO_PLAYING&&UPLAYER_GLOBAL_CONF.VIDEO.paused){if(!uplayer.utils.VisibleUtil.isVisible(wait)){uplayer.utils.VisibleUtil.show(wait);that.pauseVideo();}}},1000); function onKernelStatus(type,value){trace('UPLAYER.onKernelStatus',type);if(callback)callback(type,value);}  ;this.playVideo=function(value){trace("UPLAYER.playVideo",value);this.closeVideo();return kernel.playVideo(value);} ;this.pauseVideo=function(){return kernel.pauseVideo();} ;this.resumeVideo=function(){return kernel.resumeVideo();} ;this.seekVideo=function(value){return kernel.seekVideo(value);} ;this.closeVideo=function(){return kernel.closeVideo();} ;this.getVideoTime=function(){return kernel.getVideoTime();} ;this.getVideoInfo=function(){return kernel.getVideoInfo();};this.getLoadPercent=function(){return kernel.getLoadPercent();};this.getBufferPercent=function(){return kernel.getBufferPercent();};this.getVideoVolume=function(){return kernel.getVideoVolume();} ;this.setVideoVolume=function(value){return kernel.setVideoVolume(value);} ;this.setVideoPlayRate=function(value){return kernel.setVideoPlayRate(value);} ;this.setViewPort=function(w,h){UPLAYER_GLOBAL_CONF.APP_WIDTH=w;UPLAYER_GLOBAL_CONF.APP_HEIGHT=h;return true;}} ;uplayer.core.UPLAYER=function(callback,container,playervars){trace('[UPLAYER VERSION]',UPLAYER_LOCAL_CONF.VERSION);trace('[UPLAYER SYSTEM]',window.navigator.userAgent);uplayer.callbackConnection=function(type,value){switch(type){case uplayer.JSEvent.VIDEO_START:if(value)value.html5=_isHTML5;break;case uplayer.JSEvent.PLAYER_INIT:if(!_isHTML5)_target=document.getElementById('uplayer_container_flash');break;};return callback(type,value);};var _width=970;var _height=480;var _isHTML5=false;var _target=null;if(!playervars)playervars={};playervars.callback="uplayer.callbackConnection";if(playervars.flashPlayerUrl){UPLAYER_LOCAL_CONF.FLASH_PLAYER_URL=playervars.flashPlayerUrl;};if(playervars.flashInstallUrl){UPLAYER_LOCAL_CONF.FLASH_INSTALL_URL=playervars.flashInstallUrl;};var root=document.createElement('div');root.id=UPLAYER_CONTAINER_NAME.ROOT;root.style.width="100%";root.style.height="100%";root.style.position="relative";root.style.backgroundColor="#000000";container.appendChild(root);function createHTML5Player(){_isHTML5=true;_target=new uplayer.core.UPLAYER_HTML5(uplayer.callbackConnection,root,playervars);callback(uplayer.JSEvent.PLAYER_INIT);};function createFLASHPlayer(){var flash=supportFlash();if(!flash.f||flash.v<10.2){callback(uplayer.JSEvent.VIDEO_ERROR,1099);return;};_isHTML5=false;var visualDiv=document.createElement('div');visualDiv.id='uplayer_container_visual';root.appendChild(visualDiv);var swfVersionStr="10.0.0";var xiSwfUrlStr=UPLAYER_LOCAL_CONF.FLASH_INSTALL_URL;var params={};if(playervars.wmode){params.wmode=playervars.wmode;};params.quality="high";params.bgcolor="#000000";params.allowscriptaccess="always";params.allowfullscreen="true";var attributes={};attributes.id="uplayer_container_flash";attributes.name="uplayer_container_flash";attributes.align="middle";swfobject.embedSWF(UPLAYER_LOCAL_CONF.FLASH_PLAYER_URL,'uplayer_container_visual','100%','100%',swfVersionStr,xiSwfUrlStr,playervars,params,attributes);<!--JavaScript enabled so display the flashContent div in case it is not replaced with a swf object.-->
swfobject.createCSS("#uplayer_container_visual","display:block;text-align:left;");} ;this.playVideo=function(value){if(_target){return _target.playVideo(value);};return false;} ;this.resumeVideo=function(){if(_target){return _target.resumeVideo();};return false;} ;this.pauseVideo=function(){if(_target){return _target.pauseVideo();};return false;} ;this.seekVideo=function(value){if(_target){return _target.seekVideo(value);};return false;} ;this.closeVideo=function(){if(_target){return _target.closeVideo();};return false;} ;this.getVideoTime=function(){if(_target){return _target.getVideoTime();};return 0;} ;this.getVideoInfo=function(){if(_target){return _target.getVideoInfo();};return null;} ;this.getLoadPercent=function(){if(_target){return _target.getLoadPercent();};return 0;} ;this.getBufferPercent=function(){if(_target){return _target.getBufferPercent();};return 0;} ;this.getVideoVolume=function(){if(_target){return _target.getVideoVolume();};return 0;} ;this.setVideoVolume=function(value){if(_target){return _target.setVideoVolume(value);};return false;} ;this.setVideoPlayRate=function(value){if(_target){return _target.setVideoPlayRate(value);};return false;} ;this.setViewPort=function(w,h){if(w<0||h<0){root.style.width="100%";root.style.height="100%";}else{root.style.width=w+'px';root.style.height=h+'px';return(_isHTML5?_target.setViewPort(w,h):true);}};this.activate=function(){if(playervars.vod){if(supportMPEGVideo()){createHTML5Player();}else{createFLASHPlayer();}}else{if(UPLAYER_LOCAL_CONF.SYSTEM.MOBILE){callback(uplayer.JSEvent.VIDEO_ERROR,1099);}else{createFLASHPlayer();}}}}


/**
 * fpalyer html5适配播放器，依赖于jquery
 * author yuebin
 */

function Fplayer(eleId, url) {
    var $playerCon = $(document.getElementById(eleId));
    var $fplayer = null;
    var $actionBar =  null;
    var $playPause = null;
    var $progressBar = null;
    var $bufferBar = null;
    var $visitedBar = null;
    var $volumeBar = null;
    var $curSpin = null;
    var $curTime = null;
    var $dragTarget = null;
    var $dragParent = null;
    var $volumeIcon = null;
    var $speedList = null;
    var $modeList = null;
    var $videoTitle = null;
    var $videoBarrage = null;
    var player = null;
    var isPlaying = false;
    var updateProgressTimer = null;
    var videoInfo = {};
    var volumeBarLength = 67;
    var dragBaseX = 0;
    var dragLength = 0;
    var dragAddLength = 0;
    var isDraggingProgress = false;
    var vieoPlayRate = 1;
    var videoTitle = null;
    var videoTitleIndex = 0;
    var videoBarrage = null;
    var videoBarrageY = [];
    var drag_start_time = 0;
    var drag_end_time = 0;
    var fVisitedBar = 0;

    $fplayer = $('<div class="fplayer"><p id="loading_gif" style="display: none;">正在缓冲，请稍后...</p><div class="f-uplayer"><div class="f-barrage-con"><canvas class="f-video-barrage" width="2400" height="600"></canvas></div><div class="f-video-title"></div></div><div class="f-exercise"></div><div class="action-bar-wrapper"><div class="f-action-bar"><div class="f-progress-bar"><div class="f-buffer-bar"></div><div class="f-visited-bar"><span class="f-progress-spin"></span></div></div><div class="f-icon-panel"><i class="f-icon-back"></i><i id="onOff" class="f-icon-pause" data-play="1"></i><i class="f-icon-forward"></i><i style="display:none;" class="f-icon-nextvideo"></i><i class="f-icon-sound"></i><div class="f-volume-bar"><div class="f-cur-volume"><span class="f-volume-spin"></span></div></div><span class="f-play-time"><span class="f-cur-time">00:00</span>/<span class="f-total-time">07:10</span></span><div class="f-action-right"><span class="f-text-btn LD f-mode-btn">标清</span><ul class="f-mode-list"><li type="en" class="LD" ><span>流畅</span></li><li type="cn_trad" class="SD" ><span>标清</span></li><li type="active" class="HD"><span>高清</span></li></ul><span class="f-text-btn f-subtitle">字幕</span><ul class="f-text-list"><li class="active" type="cn">中文</li><li type="en">英文</li><li type="cn_trad">繁体</li></ul><span class="f-text-btn f-speed">速度</span><ul class="f-speed-list"><li><span>2</span></li><li><span>1.5</span></li><li class="active"><span>1</span></li><li><span>0.75</span></li></ul><i class="f-icon-frame"></i><i class="f-icon-full" title="全屏"></i></div></div></div></div></div>');
    $actionBar = $fplayer.find('.f-action-bar')
    $playPause = $fplayer.find('.f-icon-pause');
    $bufferBar = $fplayer.find('.f-buffer-bar');
    $progressBar = $fplayer.find('.f-progress-bar');
    $visitedBar = $fplayer.find('.f-visited-bar');
    $curSpin = $fplayer.find('.f-progress-spin');
    $curTime = $fplayer.find('.f-cur-time');
    $volumeBar = $fplayer.find('.f-cur-volume');
    $volumeIcon = $fplayer.find('.f-icon-sound');
    $speedList = $fplayer.find('.f-speed-list');
    $modeList = $fplayer.find('.f-mode-list');
    $videoTitle = $fplayer.find('.f-video-title');
    $videoBarrage = $fplayer.find('.f-video-barrage');
	$subTitleList = $fplayer.find('.f-text-list');
	$acionBarWrapper = $fplayer.find('.action-bar-wrapper');
	$iconFrame=$fplayer.find(".f-icon-frame");
	$lastTimeTip='';
    $playerCon.append($fplayer);

	
	$this=this;
    // 模拟字幕文件
    videoTitle = [{
                "startTime": "00:00",
                "endTime": "00:01",
                "text": "111"
            },{
                "startTime": "00:01",
                "endTime": "00:09",
                "text": "222"
            }];
    //获取字幕数据
    this.getVideoTitle=function(id,type){

        var url="/api/player_srtParser.php";
        var data={
            course_id:id,
            srt_type:type||'cn',
            vid:vid
        };
        $.get(url,data,function(res){
            var ret=res.msg;
            if(res.flag!=1)
            {
                ret=[{'startTime':'00:00','endTime':'00:10','text':ret}];
				$videoTitle.hide();
            }
			else
			{
				$videoTitle.show();
				$videoTitle.html('');//清空字幕栏
				seekVideoTitle(formatTimes(0));//加载字幕
			}
            videoTitle=ret;
            aside.videoTitleInit(ret);//构造右侧字幕并初始化
        },'json');
    }
	//从任意时间开始播放
	this.playFromTime=function(time){
			
		time=parseInt(time);
		var progress=time/videoInfo.duration;
        $visitedBar.css('width', progress*100 + '%' );
        videoInfo.time = time;
        player.seekVideo(time);
        seekVideoTitle(formatTimes(time));
        uiPause();
        updateProgress(time);
        
	}
    //播放器回调函数.
    function onCallBack (type,value) {
        trace('[callback 2]',type,value);
        switch(type){
            case uplayer.JSEvent.PLAYER_INIT://播放器初始化完成，可以操作其API
					
                    player.playVideo({'data':url,'time':parseInt(last_time)});
					if(parseInt(last_time)>0)
					{
						$lastTimeTip="<div id='replay_tips' style='position:absolute;bottom:10px;left:200px;texgt-align:center;z-index:6;color:#fff;' ><span>已为您续播到上次观看时间 "+formatTimes(parseInt(last_time))+",</span><span id='replay'  style='color:red;'>您可以重头播放</span></div>";
						
						$fplayer.find(".f-uplayer").append($lastTimeTip);
						$fplayer.find("#replay").one("click",function(e){
							player.seekVideo(0);
							videoTitleIndex=0;
							
							$("#replay_tips").hide();
							return false;
						});
						setTimeout(display_hide,4000);
					}
					
                    //player.playVideo({'data':url,'time':0});
					//start_play_video(url);
                break;
            case uplayer.JSEvent.VIDEO_START://视频播放开始
                    trace("VIDEO_START",value.duration,value.changePlayRate);
					
                    isPlaying = true;
                    videoInfo = player.getVideoInfo();
                    setTotalTime(videoInfo.duration);
					
					add_pflag(videoInfo.duration);//加载练习小旗子
					
                    updateProgress();
                    requestAnimationFrame(renderBarrage);
                    $actionBar.show();
                break;
            case uplayer.JSEvent.VIDEO_EMPTY://视频缓冲区空
            	$("#loading_gif").show();
                break;
            case uplayer.JSEvent.VIDEO_FULL://视频缓冲区满
            	$("#loading_gif").hide();
                break;
			case uplayer.JSEvent.VIDEO_STOP://视频缓冲区满
                $("#loading_gif").hide();
				playfinish(videoInfo.duration)
                break;
            case uplayer.JSEvent.VIDEO_ERROR://视频播放错误
                break;
            case uplayer.JSEvent.RED5_INFO://flash red5 录播模式右侧聊天记录.
                break;
        }
    }
	
	function display_hide()
	{
		$("#replay_tips").hide(1000);
	}
    player = new uplayer.core.UPLAYER (
        onCallBack,
        $fplayer.find('.f-uplayer')[0],
        {
            "flashPlayerUrl": "bin/Player.swf"
            ,"flashInstallUrl": "bin/playerProductInstall.swf"
            ,"wmode": "transparent"
            ,"vod": true
        }
    );
    player.activate();

    // 暴露出uplayer对象，供接口调用
    this.player = player;

    // 播放
    $fplayer.on('click', '.f-icon-play', function(e) {
    	if(window.DISABLEPLAY)
    	{
    		return;
    	}
        player.resumeVideo();
        uiPause();$(this).attr("data-play","1");
        app.exercise.startcheckTime();
    });

    // 暂停
    $fplayer.on('click', '.f-icon-pause', function(e) {
        player.pauseVideo();$(this).attr("data-play","0");
        uiPlay();
    });

    // 播放区域点击事件
    $fplayer.on('click', '.f-uplayer', function(e) {
        if (isPlaying) {
            player.pauseVideo();$("#onOff").attr("data-play","0");
            uiPlay();
        } else {
            player.resumeVideo();$("#onOff").attr("data-play","1");
            uiPause();
        }
    });

    // 静音
    $fplayer.on('click', '.f-icon-sound', function(e) {
        setVolume(0);
        $(e.target).addClass('f-icon-mute').removeClass('f-icon-sound');
    });

    // 音量点击设置
    $fplayer.on('click', '.f-volume-bar', function(e) {
        if ($(e.target).hasClass('f-volume-spin')) {
            return false;
        }
        var volume = (e.offsetX+3.5)/volumeBarLength;
        player.setVideoVolume(volume);
        $volumeBar.css('width', volume*100 + '%' );
        videoInfo.volume = volume;

        if (volume == 0) {
            $volumeIcon.addClass('f-icon-mute').removeClass('f-icon-sound');
        } else {
            $volumeIcon.addClass('f-icon-sound').removeClass('f-icon-mute');
        }
    });
	
    //全屏和退出全屏

	var oleft=$fplayer.css("left");
    $fplayer.on('click', '.f-icon-full', function(e) {

		if ($fplayer.width()>900) 
		{
            $(this).attr("data-full",0);
			$fplayer.fullScreen(false);
			$iconFrame.css({"visibility":"visible"});
			$fplayer.css({"width":855,'left':oleft});//恢复
			
	
	
		}
		else
		{
            $(this).attr("data-full",1);
			oleft=$fplayer.css('left');
			
			$fplayer.css({"width":"100%","left":0});
			$iconFrame.css({"visibility":"hidden"});
			$fplayer.fullScreen(true);
		
		}
		
		
    });

	document.addEventListener("fullscreenchange", function () {
		if(!document.fullscreen)
		{
			$fplayer.css({"width":855,'left':oleft});
			$iconFrame.css({"visibility":"visible"});
		}

	}, false);
	 
	document.addEventListener("mozfullscreenchange", function (e) {

		if(!document.mozFullScreen)
		{
			$fplayer.css({"width":855,'left':oleft});
			$iconFrame.css({"visibility":"visible"});
		}

	
	}, false);
	 
	document.addEventListener("webkitfullscreenchange", function () {
		if(!document.webkitIsFullScreen)
		{
			$fplayer.css({"width":855,'left':oleft});
			$iconFrame.css({"visibility":"visible"});
		}
		
	}, false);
	document.addEventListener("msfullscreenchange", function (e) {
		
		if(!document.msFullscreenElement)
		{
			$fplayer.css({"width":855,'left':oleft});
			$iconFrame.css({"visibility":"visible"});
		}
	
	}, false);

    // 解除静音
    $fplayer.on('click', '.f-icon-mute', function(e) {
        if (typeof videoInfo.volume === 'number') {
            setVolume(videoInfo.volume);
        } else {
            setVolume(1);
        }
        $(e.target).addClass('f-icon-sound').removeClass('f-icon-mute');
    });

    // 前进
    $fplayer.on('click', '.f-icon-forward', function(e) {
		if(window.DISABLEPLAY) return;
        var seekTime = player.getVideoTime() + 5;
        if (seekTime > videoInfo.duration) {
            seekTime = videoInfo.duration;
        }
        player.seekVideo(seekTime);
        seekVideoTitle(formatTimes(seekTime));
        uiPause();$("#onOff").attr("data-play","1");
        updateProgress(seekTime);
    });

    // 后退
    $fplayer.on('click', '.f-icon-back', function(e) {
		if(window.DISABLEPLAY) return;
        var seekTime = player.getVideoTime() - 5;
        player.seekVideo(seekTime);
        seekVideoTitle(formatTimes(seekTime));
        uiPause();$("#onOff").attr("data-play","1");
        updateProgress(seekTime);
    });

    //剧场模式
    $fplayer.on('click','.f-icon-frame',function(e){
        var $this=$(this);
        var $aside=$('.aside');
        var frame=$this.data('frame');
        if(window.isfold)//是折叠模式
        {
            return;
            // $('.unfold-btn').trigger('click');
        }
        if(frame)//是剧场模式，退出模式
        {
            $fplayer.animate({'left':'0'},80,function(){
                $aside.animate({'top':'0'},300);
                $this.data('frame',false);
                $(".tiger_fixed_1").animate({'margin-left':'0'},80);
                $('.fold-btn').show();
                $(".aside .aside-tabs ul li").animate({'height':'60px'},80);
                $('.left-silder').show();
            });
        }
        else
        {
            $aside.animate({'top':'520px'},300,function(){
                $fplayer.animate({'left':'212px'},80);
                $(".tiger_fixed_1").animate({'margin-left':'212px'},80);
                $(".aside .aside-tabs ul li").animate({'height':'40px'},80);
                $this.data('frame',true);

                $('.fold-btn').hide();
                $('.left-silder').hide();

            });
        }
		oleft=$fplayer.css("left");
    });

    // 进度点击设置
    $fplayer.on('click', '.f-progress-bar', function(e) {
		if(window.DISABLEPLAY) return;
        if ($(e.target).hasClass('f-progress-spin')) {
            return false;
        }
		//brian 0210
		var foffset=$fplayer.offset().left;
		var progress=(e.pageX-foffset)/$progressBar.width();
        //var progress = (e.offsetX+8.5)/$progressBar.width();
	

		
        if (progress > 1) {
            progress = 1;
        }

        var time = progress*videoInfo.duration;
		time=parseInt(time);
        $visitedBar.css('width', progress*100 + '%' );
        videoInfo.time = time;
        player.seekVideo(time);
        seekVideoTitle(formatTimes(time));
        uiPause();
        updateProgress(time);
        /*开始拖拽 记录是否拖拽过*/
        var url = '/course.php?ac=course_view_blog&op=log';
        var kvideo_name = $("#wrapper").data("kvideoid");
        var course_name = $("#ellipsis > a.fl").text();
        var start_time = drag_start_time;
        drag_start_time = $(".f-cur-time").text();
        if($("#wrapper").data("kvideoid")==4757){
        	dragLog(url,kvideo_name,course_name,start_time,formatTimes(time));
        }
    });

    // 音量拖拽设置
    $fplayer.on('mousedown', '.f-volume-spin', function(e) {
        if (e.button === 0) {
            $dragTarget = $(e.target).closest('.f-cur-volume');
            $dragParent = $dragTarget.parent();
            dragBaseX = $dragParent.offset().left;
            dragLength = $dragParent.width();
            window.getSelection && window.getSelection().removeAllRanges();
            dragAddLength = 4;
        }
    });

    // 进度拖拽设置
    $fplayer.on('mousedown', '.f-progress-spin', function(e) {
		if(window.DISABLEPLAY) return;
        if (e.button === 0) {
            drag_start_time = $(".f-cur-time").text();
            $dragTarget = $(e.target).closest('.f-visited-bar');
            $dragParent = $dragTarget.parent();
            dragBaseX = $dragParent.offset().left;
            dragLength = $dragParent.width();
            window.getSelection && window.getSelection().removeAllRanges();
            isDraggingProgress = true;
            dragAddLength = 9;
        }
    });
    /*记录视频拖拽 快进 等信息*/
    function dragLog(url,kvideo_name,course_name,start_time,end_time){
        $.ajax({
            type:'post',
            dataType:'json',
            data:{
            	"kvideoid":$("#wrapper").data("kvideoid"),
                "kvideo_name":kvideo_name,
                "course_name":course_name,
                "start_time":start_time,
                "end_time":end_time
            },
            url:url,
            success:function(data){
                //console.log(data);

            }
        });
    };
    // 绑定全屏拖拽事件，同时用off防止多次绑定
    $(document).off('.dragFspin').on('mousemove.dragFspin', function(e) {
        if ($dragTarget) {
            var _left = e.pageX - dragBaseX + dragAddLength;
            if (_left<0) {
                _left = 0;
            }
            if (_left > dragLength) {
                _left = dragLength;
            }
            $dragTarget.css({
                width: _left/dragLength*100 + '%'
            });
        }
    });

    // 拖拽过程防止选择文本
    $(document).on('selectstart.dragFspin', function(e) {
        if ($dragTarget) {
            return false;
        }
    });

    // 拖拽结束，设置结果
    $(document).on('mouseup.dragFspin onSelectStart.dragFspin', function(e) {

        if ($dragTarget) {
            isDraggingProgress = false;
            var _percent = $dragTarget.width()/dragLength;

            if ($dragTarget.hasClass('f-cur-volume')) {
                setVolume(_percent);
                
                videoInfo.volume = _percent;

                if (_percent == 0) {
                    $volumeIcon.addClass('f-icon-mute').removeClass('f-icon-sound');
                } else {
                    $volumeIcon.addClass('f-icon-sound').removeClass('f-icon-mute');
                }

            } else if ($dragTarget.hasClass('f-visited-bar')) {
                var _percent = $dragTarget.width()/dragLength;
                player.seekVideo(_percent*videoInfo.duration);
                var time = formatTimes(_percent*videoInfo.duration);
                seekVideoTitle(formatTimes(_percent*videoInfo.duration));
                uiPause();
                updateProgress(_percent*videoInfo.duration);

            }
            $dragTarget = null;
            /*拖拽 。。。*/
            var url = '/course.php?ac=course_view_blog&op=log';
	        var kvideo_name = $("#wrapper").data("kvideoid");
	        var course_name = $("#ellipsis > a.fl").text();
	        var start_time = drag_start_time;
	        drag_start_time = $(".f-cur-time").text();
	        if($("#wrapper").data("kvideoid")==4757){
	        	dragLog(url,kvideo_name,course_name,start_time,time);
	        }
        
        }
       // return false;
    });


    //速度更改
    var speedHoverTimer = null;
    $fplayer.on('mouseenter', '.f-speed', function(e) {
        clearTimeout(speedHoverTimer);
        $speedList.show();
    }).on('mouseleave', '.f-speed', function(e) {
        speedHoverTimer = setTimeout(function() {
            $speedList.hide();
        }, 500)
    });
	
    // 速度列表事件
    $speedList.on('mouseenter', function(e) {
        clearTimeout(speedHoverTimer);
    }).on('mouseleave', function(e) {
        $speedList.hide();
    }).on('click', 'span', function(e) {
        var $li = $(e.target).closest('li');
        if (!$li.hasClass('active')) {
            $li.addClass('active').siblings('.active').removeClass('active');
            vieoPlayRate = parseFloat($li.text());
            player.setVideoPlayRate(vieoPlayRate);
        }
        $speedList.hide();
    });


    //播放模式更改
    var smodeHoverTimer = null;
    $fplayer.on('mouseenter', '.f-mode-btn', function(e) {
        clearTimeout(smodeHoverTimer);
        if($(".f-mode-list li[name='dblock']").length>0){
            $modeList.show();
        }
    }).on('mouseleave', '.f-mode-btn', function(e) {
        smodeHoverTimer = setTimeout(function() {
            $modeList.hide();
        }, 500)
    });
// 播放模式列表点击事件
    var uplayer_video ;
    uplayer_video = document.getElementById("uplayer_video");
    var value = null;
    $modeList.on('mouseenter', function(e) {
        clearTimeout(smodeHoverTimer);
    }).on('mouseleave', function(e) {
        $modeList.hide();
    }).on('click', 'span', function(e) {
        var $li = $(e.target).closest('li');
        if (!$li.hasClass('active')) {
            $li.addClass('active').siblings('.active').removeClass('active');
            vieoPlayRate = parseFloat($li.text());
            player.setVideoPlayRate(vieoPlayRate);
            value= uplayer_video.currentTime;
            var video_url =  $li.data("video_url");
            fplayer.playFromTime(value*60);
            player.playVideo({'data':video_url,'time':parseInt(value)});
            $(".f-mode-btn").text($(this).text());
            if (isPlaying) {
                player.pauseVideo();
                uiPlay();
            } else {
                player.resumeVideo();
                uiPause();
            }
        }
        $modeList.hide();
    });


	//字幕更改
	var subTitleTimer = null;
	$fplayer.on('mouseenter', '.f-subtitle', function(e) {
        clearTimeout(subTitleTimer);
        $subTitleList.show();
    }).on('mouseleave', '.f-text-btn', function(e) {
        subTitleTimer = setTimeout(function() {
            $subTitleList.hide();
        }, 500)
    });
	// 字幕列表事件
    $subTitleList.on('mouseenter', function(e) {
        clearTimeout(subTitleTimer);
    }).on('mouseleave', function(e) {
        $subTitleList.hide();
    }).on('click', 'li', function(e) {
		$subTitleList.find('li').removeClass('active');
		$(e.target).addClass('active');
		//$this.getVideoTitle($('#wrapper').attr("data-courseid"),$(e.target).attr('type'));
		$this.getVideoTitle(window.courseid,$(e.target).attr('type'));
		//change_subtitle($(e.target).attr('type'));
        $subTitleList.hide();
    });	
	
    // 修改UI为暂停状态，icon为播放按钮
    function uiPlay() {
        isPlaying = false;
        $playPause.addClass('f-icon-play').removeClass('f-icon-pause');
    }

    // 修改UI为播放状态，icon为暂停按钮
    function uiPause() {
        if (!isPlaying) {
            requestAnimationFrame(renderBarrage);
        }
        isPlaying = true;
        updateProgress();
        $playPause.addClass('f-icon-pause').removeClass('f-icon-play');
    }

    // 秒格式化, 秒->00:00
    function formatTimes(times) {
        if (typeof times === 'number') {
            return (parseInt(times/60) + 100).toString().substr(1)
                + ':'
                + (parseInt(times%60) +100).toString().substr(1);
        }

        return '';
    }

    // 设置视频总时间
    function setTotalTime(times) {
        $actionBar.find('.f-total-time').text(formatTimes(times));
    }   

    // 更新进度条和时间
    function updateProgress(times) {
        clearTimeout(updateProgressTimer);

        if (isPlaying) {
            var curTime = times || player.getVideoTime();

            // 不拖拽滚动条是更新位置
            if (!isDraggingProgress) {
                $visitedBar.css('width', curTime/videoInfo.duration*100 + '%');
            }

            $curTime.text(formatTimes(curTime));

            // 调整计时器,尽量在整秒的时候调整
            updateProgressTimer = setTimeout(updateProgress, (1-curTime%1)*1000/vieoPlayRate);
			
			if(times<1)
			{
				videoTitleIndex = 0;
			}
            // 字幕
            updateVideoTitle(formatTimes(curTime));
			
            // console.log(curTime, ':', videoInfo.duration);
            // 播放借宿
            if (curTime >= videoInfo.duration) {
                isPlaying = false;
                uiPlay();
                videoTitleIndex = 0;
            }
        }
    }

    // 重新查找字幕基准索引
/*    function seekVideoTitle(times) {
        for (var i = 0; i < videoTitle.length; i++) {
            if (times >= videoTitle[i].startTime && times <= videoTitle[i].endTime) {
                videoTitleIndex = i;
                break;
            }
        }
    }*/
	function seekVideoTitle(times) {
        for (var i = 0; i < videoTitle.length; i++) {
            if ( compare_strtime( videoTitle[i].startTime,times) >= 0 &&  compare_strtime( videoTitle[i].endTime,times) <=0) {
                videoTitleIndex = i;
                break;
            }
        }
    }
    function compare_strtime (start, end)
    {
        var reg = /\:/g;
         
        var sDate = new Date;
        var s = start.split (reg);
        sDate.setMinutes (s[0]);
        sDate.setSeconds (s[1]);
         
        var eDate = new Date;
        var e = end.split (reg);
        eDate.setMinutes (e[0]);
        eDate.setSeconds (e[1]);
         
        return eDate.getTime() - sDate.getTime();
    }
    // 更新字幕
    //同时更新右侧字幕
/*    function updateVideoTitle(times) {
        if (videoTitleIndex >= videoTitle.length) {
            return false;
        }
        aside.updateVideoTitle(videoTitleIndex);
        if (times >= videoTitle[videoTitleIndex].startTime && times <= videoTitle[videoTitleIndex].endTime) {
            $videoTitle.text(videoTitle[videoTitleIndex].text);
            return false;
        } else if (times > videoTitle[videoTitleIndex].endTime) {
            $videoTitle.text('');
            videoTitleIndex ++;
        }
    }*/
	function updateVideoTitle(times) {
        if (videoTitleIndex >= videoTitle.length) {
            return false;
        }
		//delete  console.log(times,videoTitleIndex);
        aside.updateVideoTitle(videoTitleIndex);
		
        if ( compare_strtime( videoTitle[videoTitleIndex].startTime,times) >= 0 &&  compare_strtime( videoTitle[videoTitleIndex].endTime,times) <=0) {
            $videoTitle.text(videoTitle[videoTitleIndex].text);
            return false;
        } else if ( compare_strtime( videoTitle[videoTitleIndex].endTime,times) > 0) {
            $videoTitle.text('');
            videoTitleIndex ++;
        }
    }
	
    // 设置音量条, 0-1
    function setVolume(volume) {
        if (volume >= 0 && volume <= 1) {
            // console.log(volume);
            player.setVideoVolume(volume);
            $volumeBar.css('width', (volume/0.01) + '%');
        }
    }

    var barragectx = $videoBarrage[0].getContext('2d');
    var barrageWidth = 2400;
    var barrageHeight = 600;
    // 设置字体
    barragectx.font = "40px Arial"; 
    // 设置对齐方式
    barragectx.textAlign = "left";
    // 设置填充颜色
    barragectx.fillStyle = "#fff";
    // 设置字体内容，以及在画布上的位置
    // barragectx.fillText("Hello!", 10, 50);
    // 模拟弹幕数据
    videoBarrage = [{
        "text": '测试弹幕1',
        "x": barrageWidth,
        "y": 0,
        "taking": true
    }, {
        "text": '测试弹幕2',
        "x": barrageWidth,
        "y": 1,
        "taking": true
    }, {
        "text": '测试弹幕3',
        "x": barrageWidth,
        "y": 2,
        "taking": true
    }, {
        "text": '测试弹幕4',
        "x": barrageWidth,
        "y": 3,
        "taking": true
    }, {
        "text": '测试弹幕5',
        "x": barrageWidth,
        "y": 4,
        "taking": true
    }];
    // 可用弹幕通道
    videoBarrageY = [5, 6, 7, 8, 9];

    //增加弹幕
    function addBarrage(text) {
        // 无可用通道返回false
        if (videoBarrageY.length === 0) {
            return false;
        }

        // 计算出一个可用y通道
        var barrageY = parseInt(Math.random()*videoBarrageY.length - 1);

        videoBarrage.push({
            text: text,
            x: barrageWidth,
            y: videoBarrageY[barrageY],
            taking: true
        });

        videoBarrageY.splice(barrageY, 1);
        return true;
    }

    // 渲染弹幕
    function renderBarrage() {
		return 1;//暂时取消弹幕 by brian 0205
		if (!isPlaying) {
            return false;
        }

        // 随机增加测试弹幕
        if (Math.random()>0.95)
            addBarrage(Math.random());

        barragectx.clearRect(0, 0, barrageWidth, barrageHeight);

        var i = 0;
        while(i < videoBarrage.length) {
            videoBarrage[i].x -= 3*vieoPlayRate;

            // 增加弹幕通道,标记通道未占用
            if (videoBarrage[i].taking 
                && videoBarrage[i].x + barragectx.measureText(videoBarrage[i].text).width < barrageWidth - 40) {
                videoBarrageY.push(videoBarrage[i].y);
                videoBarrage[i].taking = false;
            }

            if (videoBarrage[i].x + barragectx.measureText(videoBarrage[i].text).width < 0) {
                // 删掉已滑出可视区域的弹幕
                videoBarrage.splice(i, 1);
            } else {
                barragectx.fillText(
                    videoBarrage[i].text,
                    videoBarrage[i].x,
                    videoBarrage[i].y*60 + 50
                );
                i++;
            }
        }

        window.FrameId=requestAnimationFrame(renderBarrage);
    }

    //停止弹幕
    this.stopBarrage=function(){
        cancelAnimationFrame(window.FrameId);
    }
    // 兼容性requestAnimationFrame处理
    (function() {
        var lastTime = 0;
        var vendors = ['webkit', 'moz'];
        for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||    // Webkit中此取消方法的名字变了
                                          window[vendors[x] + 'CancelRequestAnimationFrame'];
        }

        if (!window.requestAnimationFrame) {
            window.requestAnimationFrame = function(callback, element) {
                var currTime = new Date().getTime();
                var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
                var id = window.setTimeout(function() {
                    callback(currTime + timeToCall);
                }, timeToCall);
                lastTime = currTime + timeToCall;
                return id;
            };
        }
        if (!window.cancelAnimationFrame) {
            window.cancelAnimationFrame = function(id) {
                clearTimeout(id);
            };
        }
    }());

	//鼠标离开播放器 操作按钮消失
/***** 
 	b_startTime=new Date().getTime(); 
	var b_endTime;

	$fplayer.on("mouseenter",function(e){
		clearTimeout(window.aa);
		$(".f-action-bar").slideDown();
	}).on('mouseleave',function(){
		window.aa=setTimeout(function(){
			$(".f-action-bar").slideUp();
		},2000);
	}).on('mousemove',function(){
		b_startTime=new Date().getTime();
	});
	setInterval(function(){
		var b_endTime=new Date().getTime();
		if((b_endTime-b_startTime)>2*1000)
		{
			$(".f-action-bar").slideDown();
		}
	},1000);
***/	
 	var b_startTime=new Date().getTime(); 
	var b_endTime;
	$fplayer.css({"overflow":"hidden"});
	$fplayer.on("mousemove",$actionBar,function(e){
			 mousemove_event();
		
	});
	function mousemove_event()
	{

		$fplayer.off("mousemove");
		var height=$acionBarWrapper.height();
		
		if(height==0)
		{

			$acionBarWrapper.animate({"height":45},500,function(){
				$acionBarWrapper.css({"overflow":"visible"});
				});
			
		}

		setTimeout(bind_mousemove_event,1000);
		b_startTime=new Date().getTime();
	}
	function bind_mousemove_event()
	{
		$fplayer.on("mousemove",function(e){mousemove_event();});
	}
	$fplayer.on("mouseout",function(e){
	
		b_startTime=new Date().getTime();
		
		
	});
	setInterval(hide_controlbar,1000);
	function hide_controlbar()
	{
		b_endTime=new Date().getTime();

		if(b_endTime-b_startTime>5000)
		{
			$acionBarWrapper.css({"overflow":"hidden"});
            $acionBarWrapper.animate({"height":0},500);

		}

	}


}   